<!DOCTYPE html>
<html>
<head>
  <title>MIDI Converter</title>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
  <link href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href= "{{ url_for('static',filename='app.css') }}">
  
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
  
</head>

<body>
        
    <br>
    
    <div class="col-xs-10 col-md-offset-1">

    <form action = "/uploaded" method = "POST"
    enctype = "multipart/form-data">
    
    <b>What genre is your MIDI file?</b>
    <select class="form-control" name="fromGenre" class="input-small">
    <option>Classic</option>
    <option>Jazz</option>
    <option>Pop</option>
    <option>Metal</option>
    <option>Rap</option>
    </select>
        
    <b>What genre should your MIDI file be converted to?</b>
    <select class="form-control" name="toGenre" class="input-small">
    <option>Classic</option>
    <option>Jazz</option>
    <option>Pop</option>
    <option>Metal</option>
    <option>Rap</option>
    </select>
              
    <input type = "file" name = "file" class="form-control-file"/>
    <input type = "submit" class="btn btn-info" value="Upload MIDI"/>
    </form>
    
    </div>

<div class="col-xs-12">

<br>

<div id = "progressinfo">
<p></p>
</div>

<div id = "userinfo">
<p></p>
</div>

</div>

</body>

<script type="text/javascript">
$('form').submit(function(e){
e.preventDefault();

// Window.open("http://usuaris.tinet.cat/bttt/escacs/nimzowitsch%20-%20my%20system.pdf")
// <a href="http://usuaris.tinet.cat/bttt/escacs/nimzowitsch%20-%20my%20system.pdf" download>mysystem.pdf</a>
// var downloadUrl = "http://usuaris.tinet.cat/bttt/escacs/nimzowitsch%20-%20my%20system.pdf";
// setTimeout("window.location.assign('" + downloadUrl + "');", 1000);

// <a href="http://usuaris.tinet.cat/bttt/escacs/" download="nimzowitsch%20-%20my%20system.pdf">Download</a>


// let imgPlaceholder = document.getElementById('image-placeholder')

let progressinfo = document.getElementById('progressinfo')
progressinfo.innerHTML = '<loadingtext><img src="/static/spinner.gif" width="200px" height="200px" class ="center-block"><p><i>Processing MIDI...</i></p></loadingtext>'



var form = document.getElementById("form");
var fd = new FormData($('form'));

console.log(fd)

$.ajax({
url: $(this).attr('action'),
type: 'POST',
data: new FormData($('form')[0]),
cache: false,
contentType: false,
processData: false

}).done(function(res){

if (res['success'] == true) {

face_location = res['face_image']
original_image = res['original_image']

console.log(res)

// imgPlaceholder.innerHTML = '<img src="/static/qm.jpg">'

progressinfo.innerHTML = '<loadingtext><img src="/static/spinner.gif" width="200px" height="200px" class ="center-block"><p><i>Converting MIDI...</i></p><p><b>' + res['msg'] + '</b></p></loadingtext>'

$.ajax({
url: "/analyze",
type: 'POST',
data: original_image,
cache: false,
contentType: false,
processData: false 
}).done(function(res){
// imgPlaceholder.innerHTML = '<img src="' + face_location + '">'
// userinfo.innerHTML = res
console.log(res)
})

} else {

progressinfo.innerHTML = '<b>' + res['msg'] + '</b>'

var link = document.createElement('a');
document.body.appendChild(link);
link.href = "http://usuaris.tinet.cat/bttt/escacs/nimzowitsch%20-%20my%20system.pdf";
link.download = "nimzowitsch%20-%20my%20system.pdf"
link.click();

}

})
})
</script>

</html>
